<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Urbana Visi√≥n - Cat√°logo</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #334155 100%); min-height: 100vh; color: white; }
        .container { max-width: 430px; margin: 0 auto; padding: 15px; }
        .header { background: rgba(255, 255, 255, 0.1); border-radius: 25px; padding: 30px 25px; text-align: center; margin-bottom: 25px; border: 1px solid rgba(255, 255, 255, 0.1); }
        .logo { width: 65px; height: 65px; background: linear-gradient(135deg, #3b82f6, #8b5cf6, #ec4899); border-radius: 50%; margin: 0 auto 20px; display: flex; align-items: center; justify-content: center; font-size: 28px; }
        .brand-name { font-size: 26px; font-weight: 700; margin-bottom: 8px; }
        .tagline { font-size: 14px; opacity: 0.9; margin-bottom: 20px; }
        .contact-info { display: flex; justify-content: center; gap: 20px; flex-wrap: wrap; font-size: 13px; }
        .contact-item { display: flex; align-items: center; gap: 6px; padding: 8px 12px; background: rgba(255, 255, 255, 0.1); border-radius: 15px; }
        .product-card { background: rgba(255, 255, 255, 0.1); border-radius: 25px; padding: 25px; margin-bottom: 20px; border: 1px solid rgba(255, 255, 255, 0.1); }
        .product-image { width: 100%; max-width: 350px; height: 350px; border-radius: 20px; margin: 0 auto 25px; display: block; object-fit: cover; border: 2px solid rgba(255, 255, 255, 0.2); }
        .product-info { text-align: center; }
        .product-code { background: linear-gradient(135deg, #3b82f6, #6366f1); color: white; padding: 10px 20px; border-radius: 25px; font-size: 16px; font-weight: 700; display: inline-block; margin-bottom: 15px; text-transform: uppercase; }
        .product-category { background: rgba(251, 146, 60, 0.2); color: #fb923c; padding: 8px 16px; border-radius: 20px; font-size: 13px; font-weight: 600; display: inline-block; margin-bottom: 15px; border: 1px solid rgba(251, 146, 60, 0.3); }
        .product-name { font-size: 22px; font-weight: 700; margin-bottom: 15px; }
        .product-price { font-size: 32px; font-weight: 800; color: #10b981; margin-bottom: 25px; }
        .features-section { background: rgba(255, 255, 255, 0.05); border-radius: 15px; padding: 20px; margin-bottom: 25px; }
        .features-title { color: #60a5fa; font-size: 16px; font-weight: 600; margin-bottom: 15px; text-align: center; }
        .features-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        .feature-item { display: flex; align-items: center; gap: 8px; font-size: 13px; padding: 8px; background: rgba(255, 255, 255, 0.05); border-radius: 8px; }
        .whatsapp-button { background: linear-gradient(135deg, #25d366, #128c7e); color: white; padding: 18px; border: none; border-radius: 20px; font-size: 18px; font-weight: 700; cursor: pointer; width: 100%; text-decoration: none; display: flex; align-items: center; justify-content: center; gap: 12px; margin-bottom: 15px; }
        .catalog-button { background: rgba(99, 102, 241, 0.2); color: #a5b4fc; padding: 15px; border: 1px solid rgba(99, 102, 241, 0.3); border-radius: 15px; font-size: 15px; font-weight: 600; cursor: pointer; width: 100%; text-decoration: none; display: flex; align-items: center; justify-content: center; gap: 10px; border: none; }
        .catalog-filters { background: rgba(255, 255, 255, 0.1); border-radius: 20px; padding: 20px; margin-bottom: 25px; }
        .filters-title { color: #60a5fa; font-size: 16px; font-weight: 600; margin-bottom: 15px; text-align: center; }
        .filter-buttons { display: flex; gap: 8px; flex-wrap: wrap; justify-content: center; }
        .filter-btn { background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.2); color: white; padding: 10px 16px; border-radius: 25px; font-size: 13px; cursor: pointer; }
        .filter-btn.active { background: #3b82f6; border-color: #3b82f6; }
        .catalog-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(170px, 1fr)); gap: 15px; margin-bottom: 25px; }
        .catalog-item { background: rgba(255, 255, 255, 0.1); border-radius: 15px; padding: 15px; text-align: center; cursor: pointer; border: 1px solid rgba(255, 255, 255, 0.1); }
        .catalog-item:hover { transform: translateY(-5px); background: rgba(255, 255, 255, 0.15); }
        .catalog-item-image { width: 100%; height: 130px; border-radius: 10px; object-fit: cover; margin-bottom: 12px; }
        .catalog-item-code { font-size: 13px; font-weight: 700; color: #60a5fa; margin-bottom: 8px; }
        .catalog-item-price { font-size: 16px; font-weight: 700; color: #10b981; }
        .category-section { background: rgba(255, 255, 255, 0.1); border-radius: 20px; padding: 25px; margin-bottom: 20px; }
        .category-title { color: #60a5fa; font-size: 18px; font-weight: 700; margin-bottom: 20px; text-align: center; }
        .loading-state, .empty-state, .error-state { text-align: center; padding: 60px 20px; }
        .state-icon { font-size: 64px; margin-bottom: 20px; }
        .state-title { font-size: 20px; font-weight: 600; margin-bottom: 10px; }
        .image-error { width: 100%; height: 200px; background: rgba(100, 116, 139, 0.3); border-radius: 10px; display: flex; align-items: center; justify-content: center; color: #64748b; font-size: 48px; }
        @media (max-width: 480px) { .catalog-grid { grid-template-columns: repeat(2, 1fr); } .contact-info { flex-direction: column; gap: 10px; } .features-grid { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">üëì</div>
            <h1 class="brand-name">Urbana Visi√≥n</h1>
            <p class="tagline">Monturas de calidad premium</p>
            <div class="contact-info">
                <div class="contact-item"><span>üì±</span><span>809-713-5307</span></div>
                <div class="contact-item"><span>üéÅ</span><span>6 meses garant√≠a</span></div>
                <div class="contact-item"><span>üöö</span><span>Env√≠o gratis</span></div>
            </div>
        </div>
        <div id="mainContent">
            <div class="loading-state">
                <span class="state-icon">üîÑ</span>
                <div class="state-title">Cargando cat√°logo...</div>
                <div>Un momento por favor</div>
            </div>
        </div>
    </div>

    <script>
        const GITHUB_CONFIG = {
            username: 'urbana419',
            repo: 'catalogo-urbana',
            branch: 'main'
        };

        function obtenerParametroUrl(nombre) {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(nombre);
        }

        // Obtener monturas desde GitHub con fallback a localStorage
        async function obtenerMonturas() {
            try {
                // Intentar desde GitHub primero
                const response = await fetch(`https://raw.githubusercontent.com/${GITHUB_CONFIG.username}/${GITHUB_CONFIG.repo}/${GITHUB_CONFIG.branch}/catalogo.json?t=${Date.now()}`);
                if (response.ok) {
                    const data = await response.json();
                    return data;
                }
            } catch (error) {
                console.log('Error GitHub, intentando localStorage:', error);
            }
            
            // Fallback a localStorage
            try {
                const data = localStorage.getItem('monturas');
                return data ? JSON.parse(data) : {};
            } catch (error) {
                console.log('Error localStorage:', error);
                return {};
            }
        }

        function mostrarProducto(montura) {
            const categoryNames = {
                'hombre': 'üë® Hombres',
                'mujer': 'üë© Mujeres',
                'deportivo': 'üèÉ Deportivos',
                'ni√±os': 'üë∂ Ni√±os'
            };

            const whatsappMessage = encodeURIComponent(
                `¬°Hola! Me interesa la montura ${montura.codigo} "${montura.nombre}" por ${montura.precio}. ¬øEst√° disponible? ü•Ω`
            );

            return `
                <div class="product-card">
                    <img src="${montura.foto}" alt="Montura ${montura.codigo}" class="product-image" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                    <div class="image-error" style="display: none;">üì∑</div>
                    <div class="product-info">
                        <div class="product-code">${montura.codigo}</div>
                        <div class="product-category">${categoryNames[montura.categoria] || 'üëì Monturas'}</div>
                        <h2 class="product-name">${montura.nombre}</h2>
                        <div class="product-price">${montura.precio}</div>
                        <div class="features-section">
                            <div class="features-title">‚ú® Caracter√≠sticas Premium</div>
                            <div class="features-grid">
                                <div class="feature-item"><span>üíé</span>Material de calidad</div>
                                <div class="feature-item"><span>üîß</span>Ajuste personalizable</div>
                                <div class="feature-item"><span>‚òÄÔ∏è</span>Protecci√≥n UV</div>
                                <div class="feature-item"><span>üéÅ</span>6 meses garant√≠a</div>
                                <div class="feature-item"><span>üöö</span>Env√≠o incluido</div>
                                <div class="feature-item"><span>üíù</span>Estuche gratis</div>
                            </div>
                        </div>
                        <a href="https://wa.me/18097135307?text=${whatsappMessage}" target="_blank" class="whatsapp-button">
                            <span>üí¨</span>Consultar por WhatsApp
                        </a>
                        <button onclick="mostrarCatalogo()" class="catalog-button">
                            <span>üëÅÔ∏è</span>Ver todas las monturas
                        </button>
                    </div>
                </div>
            `;
        }

        async function mostrarCatalogo() {
            try {
                const monturas = await obtenerMonturas();
                const monturasArray = Object.values(monturas);

                if (monturasArray.length === 0) {
                    return `
                        <div class="empty-state">
                            <span class="state-icon">üì¶</span>
                            <div class="state-title">Cat√°logo en construcci√≥n</div>
                            <div>Pronto tendremos monturas disponibles</div>
                        </div>
                    `;
                }

                const categories = {
                    'hombre': { name: 'üë® Hombres', items: [] },
                    'mujer': { name: 'üë© Mujeres', items: [] },
                    'deportivo': { name: 'üèÉ Deportivos', items: [] },
                    'ni√±os': { name: 'üë∂ Ni√±os', items: [] }
                };

                monturasArray.forEach(montura => {
                    if (categories[montura.categoria]) {
                        categories[montura.categoria].items.push(montura);
                    }
                });

                let html = `
                    <div class="catalog-filters">
                        <div class="filters-title">üîç Filtrar por categor√≠a</div>
                        <div class="filter-buttons">
                            <button class="filter-btn active" onclick="filtrarCategoria('todas', event)">Todas</button>
                            <button class="filter-btn" onclick="filtrarCategoria('hombre', event)">üë® Hombres</button>
                            <button class="filter-btn" onclick="filtrarCategoria('mujer', event)">üë© Mujeres</button>
                            <button class="filter-btn" onclick="filtrarCategoria('deportivo', event)">üèÉ Deportivos</button>
                            <button class="filter-btn" onclick="filtrarCategoria('ni√±os', event)">üë∂ Ni√±os</button>
                        </div>
                    </div>
                `;

                for (const [categoryKey, categoryData] of Object.entries(categories)) {
                    if (categoryData.items.length > 0) {
                        html += `
                            <div class="category-section categoria-${categoryKey}">
                                <div class="category-title">${categoryData.name}</div>
                                <div class="catalog-grid">
                        `;

                        categoryData.items.forEach(montura => {
                            const currentUrl = new URL(window.location.href);
                            const productUrl = `${currentUrl.protocol}//${currentUrl.host}${currentUrl.pathname}?codigo=${montura.codigo}`;
                            html += `
                                <div class="catalog-item" onclick="window.location.href='${productUrl}'">
                                    <img src="${montura.foto}" alt="${montura.codigo}" class="catalog-item-image" onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                                    <div class="image-error" style="display: none; height: 130px;">üì∑</div>
                                    <div class="catalog-item-code">${montura.codigo}</div>
                                    <div class="catalog-item-price">${montura.precio}</div>
                                </div>
                            `;
                        });

                        html += `</div></div>`;
                    }
                }

                return html;
                
            } catch (error) {
                return `
                    <div class="error-state">
                        <span class="state-icon">‚ö†Ô∏è</span>
                        <div class="state-title">Error cargando cat√°logo</div>
                        <div>Intenta recargar la p√°gina</div>
                    </div>
                `;
            }
        }

        function filtrarCategoria(categoria, event) {
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            document.querySelectorAll('.category-section').forEach(section => {
                if (categoria === 'todas' || section.classList.contains(`categoria-${categoria}`)) {
                    section.style.display = 'block';
                } else {
                    section.style.display = 'none';
                }
            });
        }

        async function inicializar() {
            const codigoProducto = obtenerParametroUrl('codigo');
            const mainContent = document.getElementById('mainContent');

            if (codigoProducto) {
                try {
                    const monturas = await obtenerMonturas();
                    const montura = monturas[codigoProducto.toUpperCase()];

                    if (montura) {
                        mainContent.innerHTML = mostrarProducto(montura);
                        document.title = `${montura.codigo} - ${montura.nombre} | Urbana Visi√≥n`;
                    } else {
                        mainContent.innerHTML = `
                            <div class="error-state">
                                <span class="state-icon">üîç</span>
                                <div class="state-title">Montura no encontrada</div>
                                <div>El c√≥digo <strong>${codigoProducto}</strong> no existe</div>
                                <button onclick="mostrarCatalogoCompleto()" class="catalog-button" style="max-width: 300px; margin: 20px auto;">
                                    <span>üëÅÔ∏è</span>Ver cat√°logo completo
                                </button>
                            </div>
                        `;
                    }
                } catch (error) {
                    mainContent.innerHTML = `
                        <div class="error-state">
                            <span class="state-icon">‚ö†Ô∏è</span>
                            <div class="state-title">Error cargando producto</div>
                            <div>Intenta recargar la p√°gina</div>
                        </div>
                    `;
                }
            } else {
                const catalogoHtml = await mostrarCatalogo();
                mainContent.innerHTML = catalogoHtml;
            }
        }

        function actualizarUrl() {
            window.history.pushState({}, '', window.location.pathname);
            document.title = 'Urbana Visi√≥n - Cat√°logo de Monturas';
        }

        async function mostrarCatalogoCompleto() {
            const catalogoHtml = await mostrarCatalogo();
            document.getElementById('mainContent').innerHTML = catalogoHtml;
            actualizarUrl();
        }

        // Funci√≥n global para bot√≥n "Ver todas las monturas"
        window.mostrarCatalogo = mostrarCatalogoCompleto;

        document.addEventListener('DOMContentLoaded', inicializar);
        window.addEventListener('popstate', inicializar);
    </script>
</body>
</html>
